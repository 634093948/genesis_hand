# ğŸ”§ é‡åŒ–å’Œæ³¨æ„åŠ›é€‰é¡¹å®Œæ•´åˆ—è¡¨

**æ›´æ–°æ—¶é—´**: 2025/11/14 12:14
**æ›´æ–°å†…å®¹**: æ¢å¤å®Œæ•´çš„é‡åŒ–å’Œæ³¨æ„åŠ›æ¨¡å¼é€‰é¡¹

---

## âœ… å·²æ¢å¤å®Œæ•´é€‰é¡¹

### 1. Quantization (é‡åŒ–æ–¹å¼)

#### å®Œæ•´é€‰é¡¹åˆ—è¡¨ (12 ä¸ª)

```python
choices=[
    "disabled",                    # ç¦ç”¨é‡åŒ–
    "fp8_e4m3fn",                 # FP8 E4M3 æ ‡å‡†
    "fp8_e4m3fn_fast",            # FP8 E4M3 å¿«é€Ÿ â­ é»˜è®¤
    "fp8_e4m3fn_scaled",          # FP8 E4M3 ç¼©æ”¾
    "fp8_e4m3fn_scaled_fast",     # FP8 E4M3 ç¼©æ”¾å¿«é€Ÿ
    "fp8_e5m2",                   # FP8 E5M2 æ ‡å‡†
    "fp8_e5m2_fast",              # FP8 E5M2 å¿«é€Ÿ
    "fp8_e5m2_scaled",            # FP8 E5M2 ç¼©æ”¾
    "fp8_e5m2_scaled_fast",       # FP8 E5M2 ç¼©æ”¾å¿«é€Ÿ
    "fp4_experimental",           # FP4 å®éªŒæ€§ (éœ€è¦ RTX 5090)
    "fp4_scaled",                 # FP4 ç¼©æ”¾ (éœ€è¦ RTX 5090)
    "fp4_scaled_fast"             # FP4 ç¼©æ”¾å¿«é€Ÿ (éœ€è¦ RTX 5090)
]
```

#### é€‰é¡¹è¯´æ˜

| é€‰é¡¹ | ç²¾åº¦ | é€Ÿåº¦ | æ˜¾å­˜å ç”¨ | ç¡¬ä»¶è¦æ±‚ | æ¨èåœºæ™¯ |
|------|------|------|---------|---------|---------|
| **disabled** | æœ€é«˜ | æœ€æ…¢ | æœ€å¤§ | ä»»æ„ | é«˜è´¨é‡ç”Ÿæˆ |
| **fp8_e4m3fn** | é«˜ | ä¸­ | ä¸­ | RTX 3000+ | å¹³è¡¡è´¨é‡å’Œé€Ÿåº¦ |
| **fp8_e4m3fn_fast** â­ | é«˜ | å¿« | ä¸­ | RTX 4000+ | æ¨èé»˜è®¤ |
| **fp8_e4m3fn_scaled** | é«˜ | ä¸­ | ä¸­ | RTX 3000+ | ç¼©æ”¾ä¼˜åŒ– |
| **fp8_e4m3fn_scaled_fast** | é«˜ | å¿« | ä¸­ | RTX 4000+ | å¿«é€Ÿç¼©æ”¾ |
| **fp8_e5m2** | ä¸­é«˜ | ä¸­å¿« | å° | RTX 3000+ | èŠ‚çœæ˜¾å­˜ |
| **fp8_e5m2_fast** | ä¸­é«˜ | å¿« | å° | RTX 4000+ | å¿«é€ŸèŠ‚çœæ˜¾å­˜ |
| **fp8_e5m2_scaled** | ä¸­é«˜ | ä¸­å¿« | å° | RTX 3000+ | ç¼©æ”¾èŠ‚çœæ˜¾å­˜ |
| **fp8_e5m2_scaled_fast** | ä¸­é«˜ | å¿« | å° | RTX 4000+ | å¿«é€Ÿç¼©æ”¾èŠ‚çœ |
| **fp4_experimental** | ä¸­ | æå¿« | æå° | RTX 5090 | å®éªŒæ€§æœ€å¿« |
| **fp4_scaled** | ä¸­ | æå¿« | æå° | RTX 5090 | ç¼©æ”¾æœ€å¿« |
| **fp4_scaled_fast** | ä¸­ | æå¿« | æå° | RTX 5090 | æœ€å¿«æ¨¡å¼ |

#### æ¨èé…ç½®

**RTX 4090 / RTX 4080**:
```
quantization = "fp8_e4m3fn_fast"  # é»˜è®¤æ¨è
```

**RTX 3090 / RTX 3080**:
```
quantization = "fp8_e4m3fn"  # æ ‡å‡†æ¨¡å¼
```

**RTX 5090** (Blackwell):
```
quantization = "fp4_scaled_fast"  # æœ€å¿«æ¨¡å¼
```

**æ˜¾å­˜ä¸è¶³**:
```
quantization = "fp8_e5m2_fast"  # èŠ‚çœæ˜¾å­˜
```

---

### 2. Attention Mode (æ³¨æ„åŠ›æ¨¡å¼)

#### å®Œæ•´é€‰é¡¹åˆ—è¡¨ (8 ä¸ª)

```python
choices=[
    "sdpa",                        # PyTorch SDPA
    "flash_attn_2",               # Flash Attention 2
    "flash_attn_3",               # Flash Attention 3
    "sageattn",                   # Sage Attention â­ é»˜è®¤
    "sageattn_3",                 # Sage Attention 3 (INT8/FP16)
    "sageattn_3_fp4",             # Sage Attention 3 FP4 (RTX 5090)
    "sageattn_3_fp8",             # Sage Attention 3 FP8 (æœ€å¿«)
    "radial_sage_attention"       # Radial Sage Attention
]
```

#### é€‰é¡¹è¯´æ˜

| é€‰é¡¹ | é€Ÿåº¦ | æ˜¾å­˜å ç”¨ | ç¡¬ä»¶è¦æ±‚ | æ¨èåœºæ™¯ |
|------|------|---------|---------|---------|
| **sdpa** | æ…¢ | å¤§ | ä»»æ„ | å…¼å®¹æ€§æœ€å¥½ |
| **flash_attn_2** | å¿« | ä¸­ | RTX 3000+ | Flash Attention 2 |
| **flash_attn_3** | æ›´å¿« | ä¸­ | RTX 4000+ | Flash Attention 3 |
| **sageattn** â­ | å¿« | å° | RTX 3000+ | æ¨èé»˜è®¤ |
| **sageattn_3** | æ›´å¿« | å° | RTX 4000+ | Sage Attention 3 |
| **sageattn_3_fp4** | æå¿« | æå° | RTX 5090 | FP4 æœ€å¿« |
| **sageattn_3_fp8** | æå¿« | æå° | RTX 4000+ | FP8 æœ€å¿« |
| **radial_sage_attention** | å¿« | å° | RTX 3000+ | å¾„å‘æ³¨æ„åŠ› |

#### æ¨èé…ç½®

**RTX 4090 / RTX 4080**:
```
attention_mode = "sageattn_3_fp8"  # æœ€å¿«æ¨¡å¼
```

**RTX 3090 / RTX 3080**:
```
attention_mode = "sageattn"  # é»˜è®¤æ¨è
```

**RTX 5090** (Blackwell):
```
attention_mode = "sageattn_3_fp4"  # FP4 æœ€å¿«
```

**å…¼å®¹æ€§ä¼˜å…ˆ**:
```
attention_mode = "sdpa"  # æœ€å…¼å®¹
```

---

## ğŸ¯ æœ€ä½³ç»„åˆæ¨è

### RTX 4090 / RTX 4080 (æ¨è)

```python
base_precision = "bf16"
quantization = "fp8_e4m3fn_fast"
attention_mode = "sageattn_3_fp8"
```

**ç‰¹ç‚¹**:
- âœ… é€Ÿåº¦æœ€å¿«
- âœ… è´¨é‡ä¼˜ç§€
- âœ… æ˜¾å­˜å ç”¨åˆç†

---

### RTX 3090 / RTX 3080

```python
base_precision = "bf16"
quantization = "fp8_e4m3fn"
attention_mode = "sageattn"
```

**ç‰¹ç‚¹**:
- âœ… å¹³è¡¡æ€§èƒ½
- âœ… è´¨é‡è‰¯å¥½
- âœ… å…¼å®¹æ€§å¥½

---

### RTX 5090 (Blackwell) - æé€Ÿæ¨¡å¼

```python
base_precision = "bf16"
quantization = "fp4_scaled_fast"
attention_mode = "sageattn_3_fp4"
```

**ç‰¹ç‚¹**:
- âœ… é€Ÿåº¦æå¿«
- âœ… æ˜¾å­˜å ç”¨æå°
- âœ… éœ€è¦æœ€æ–°ç¡¬ä»¶

---

### æ˜¾å­˜ä¸è¶³ (< 12GB)

```python
base_precision = "fp16"
quantization = "fp8_e5m2_fast"
attention_mode = "sageattn"
```

**ç‰¹ç‚¹**:
- âœ… æ˜¾å­˜å ç”¨å°
- âœ… é€Ÿåº¦è¾ƒå¿«
- âœ… é€‚åˆä½æ˜¾å­˜

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### é‡åŒ–æ–¹å¼æ€§èƒ½å¯¹æ¯”

| é‡åŒ–æ–¹å¼ | ç›¸å¯¹é€Ÿåº¦ | æ˜¾å­˜å ç”¨ | è´¨é‡æŸå¤± |
|---------|---------|---------|---------|
| disabled | 1.0x | 100% | 0% |
| fp8_e4m3fn | 1.5x | 50% | <1% |
| fp8_e4m3fn_fast | 2.0x | 50% | <1% |
| fp8_e5m2_fast | 2.2x | 40% | <2% |
| fp4_scaled_fast | 3.0x | 25% | <5% |

### æ³¨æ„åŠ›æ¨¡å¼æ€§èƒ½å¯¹æ¯”

| æ³¨æ„åŠ›æ¨¡å¼ | ç›¸å¯¹é€Ÿåº¦ | æ˜¾å­˜å ç”¨ | å…¼å®¹æ€§ |
|-----------|---------|---------|--------|
| sdpa | 1.0x | 100% | âœ…âœ…âœ… |
| flash_attn_2 | 1.5x | 80% | âœ…âœ… |
| sageattn | 1.8x | 70% | âœ…âœ… |
| sageattn_3_fp8 | 2.5x | 50% | âœ… |
| sageattn_3_fp4 | 3.0x | 40% | RTX 5090 |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç¡¬ä»¶è¦æ±‚

**FP8 Fast æ¨¡å¼**:
- éœ€è¦ RTX 4000 ç³»åˆ—æˆ–æ›´æ–°
- RTX 3000 ç³»åˆ—ä½¿ç”¨æ ‡å‡† FP8

**FP4 æ¨¡å¼**:
- ä»…æ”¯æŒ RTX 5090 (Blackwell æ¶æ„)
- å…¶ä»–æ˜¾å¡ä¼šè‡ªåŠ¨é™çº§åˆ° FP8

**Sage Attention 3**:
- éœ€è¦ RTX 4000 ç³»åˆ—æˆ–æ›´æ–°
- RTX 3000 ç³»åˆ—ä½¿ç”¨ Sage Attention

### 2. è´¨é‡å½±å“

**FP8 é‡åŒ–**:
- è´¨é‡æŸå¤± < 1%
- è‚‰çœ¼å‡ ä¹æ— æ³•å¯Ÿè§‰

**FP4 é‡åŒ–**:
- è´¨é‡æŸå¤± < 5%
- é€‚åˆå¿«é€Ÿé¢„è§ˆå’Œæµ‹è¯•

### 3. å…¼å®¹æ€§

**æœ€å…¼å®¹ç»„åˆ**:
```python
base_precision = "bf16"
quantization = "disabled"
attention_mode = "sdpa"
```

**æœ€å¿«ç»„åˆ** (RTX 4090):
```python
base_precision = "bf16"
quantization = "fp8_e4m3fn_fast"
attention_mode = "sageattn_3_fp8"
```

---

## ğŸ”„ æ›´æ–°å†å²

### 2025/11/14 12:14
- âœ… æ¢å¤å®Œæ•´çš„é‡åŒ–é€‰é¡¹ (12 ä¸ª)
- âœ… æ¢å¤å®Œæ•´çš„æ³¨æ„åŠ›æ¨¡å¼ (8 ä¸ª)
- âœ… æ·»åŠ è¯¦ç»†è¯´æ˜å’Œæ¨èé…ç½®
- âœ… æ·»åŠ ç¡¬ä»¶è¦æ±‚å’Œæ€§èƒ½å¯¹æ¯”

---

## ğŸ“ ä½¿ç”¨å»ºè®®

### é¦–æ¬¡ä½¿ç”¨
1. ä½¿ç”¨é»˜è®¤é…ç½®
2. è§‚å¯Ÿç”Ÿæˆé€Ÿåº¦å’Œè´¨é‡
3. æ ¹æ®éœ€è¦è°ƒæ•´

### ä¼˜åŒ–é€Ÿåº¦
1. å¯ç”¨ `fp8_e4m3fn_fast`
2. ä½¿ç”¨ `sageattn_3_fp8`
3. å¯ç”¨ Torch Compile

### èŠ‚çœæ˜¾å­˜
1. ä½¿ç”¨ `fp8_e5m2_fast`
2. å¯ç”¨æ™ºèƒ½ VRAM ç®¡ç†
3. é™ä½åˆ†è¾¨ç‡æˆ–å¸§æ•°

### æè‡´æ€§èƒ½ (RTX 5090)
1. ä½¿ç”¨ `fp4_scaled_fast`
2. ä½¿ç”¨ `sageattn_3_fp4`
3. å¯ç”¨æ‰€æœ‰ä¼˜åŒ–

---

**ğŸ‰ å®Œæ•´é€‰é¡¹å·²æ¢å¤ï¼** ğŸ‰
