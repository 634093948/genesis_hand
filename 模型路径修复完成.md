# âœ… æ¨¡å‹è·¯å¾„ä¿®å¤å®Œæˆ

## ä¿®å¤æ—¥æœŸï¼š2025-11-14

---

## ğŸ¯ é—®é¢˜æè¿°

ä¹‹å‰çš„ä»£ç ç¡¬ç¼–ç äº†æ¨¡å‹è·¯å¾„æ£€æŸ¥ï¼ˆ`models/wav2vec2/`ï¼‰ï¼Œæ²¡æœ‰ä½¿ç”¨ ComfyUI çš„ `folder_paths` ç³»ç»Ÿï¼Œå¯¼è‡´æ— æ³•æ­£ç¡®æŸ¥æ‰¾æ¨¡å‹ã€‚

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. æ·»åŠ  `wav2vec2` åˆ° `folder_paths` âœ…

**æ–‡ä»¶**: `genesis/core/folder_paths.py`

**ä¿®æ”¹**:
```python
folder_names_and_paths["wav2vec2"] = (
    [os.path.join(models_dir, "wav2vec2")], 
    supported_pt_extensions
)
```

**æ•ˆæœ**: ç°åœ¨ `wav2vec2` æ¨¡å‹å¯ä»¥é€šè¿‡ `folder_paths` ç³»ç»ŸæŸ¥æ‰¾ï¼Œä¸å…¶ä»–æ¨¡å‹ä¸€è‡´ã€‚

---

### 2. ä¿®æ”¹ Wav2Vec æ¨¡å‹åŠ è½½é€»è¾‘ âœ…

**æ–‡ä»¶**: `genesis/apps/wanvideo_gradio_app.py`

**ä¿®æ”¹å‰**:
```python
import glob
wav2vec_models = glob.glob("models/wav2vec2/*.safetensors") + glob.glob("models/wav2vec2/*.bin")
if not wav2vec_models:
    # ç¡¬ç¼–ç è·¯å¾„æ£€æŸ¥
model_file = os.path.basename(wav2vec_models[0])
```

**ä¿®æ”¹å**:
```python
from genesis.core import folder_paths
wav2vec_models = folder_paths.get_filename_list("wav2vec2")

if not wav2vec_models:
    # ä½¿ç”¨ folder_paths ç³»ç»Ÿ
model_file = wav2vec_models[0]  # ç›´æ¥ä½¿ç”¨æ–‡ä»¶å
```

**æ•ˆæœ**: 
- âœ… ä½¿ç”¨ ComfyUI æ ‡å‡†çš„ `folder_paths` ç³»ç»Ÿ
- âœ… è‡ªåŠ¨æœç´¢æ‰€æœ‰é…ç½®çš„ wav2vec2 è·¯å¾„
- âœ… æ”¯æŒå­ç›®å½•å’Œå¤šè·¯å¾„
- âœ… ä¸å…¶ä»–æ¨¡å‹åŠ è½½æ–¹å¼ä¸€è‡´

---

### 3. é“¾æ¥ audio_encoders ç›®å½• âœ…

**åˆ›å»ºé“¾æ¥**:
```
models\audio_encoders â†’ E:\...\FuxkComfy\models\audio_encoders
```

**åŒ…å«**:
- Whisper æ¨¡å‹ï¼ˆè™½ç„¶ InfiniteTalk ä¸ä½¿ç”¨ï¼Œä½†å…¶ä»–åŠŸèƒ½å¯èƒ½éœ€è¦ï¼‰

---

## ğŸ“Š å½“å‰æ¨¡å‹é…ç½®

### å·²é“¾æ¥çš„ç›®å½•

| ç›®å½• | é“¾æ¥åˆ° | çŠ¶æ€ |
|------|--------|------|
| `models\wanvideo` | ComfyUI `diffusion_models\wan` | âœ… å·²é“¾æ¥ |
| `models\vae` | ComfyUI `vae` | âœ… å·²é“¾æ¥ |
| `models\clip_vision` | ComfyUI `clip_vision` | âœ… å·²é“¾æ¥ |
| `models\text_encoders` | ComfyUI `clip` | âœ… å·²é“¾æ¥ |
| `models\audio_encoders` | ComfyUI `audio_encoders` | âœ… å·²é“¾æ¥ |

### å¯ç”¨çš„ InfiniteTalk æ¨¡å‹

ä» `models\wanvideo\infinitetalk\`:
- âœ… `Wan2_1-InfiniteTalk-Multi_fp16.safetensors` (4.77 GB)
- âœ… `Wan2_1-InfiniTetalk-Single_fp16.safetensors` (4.77 GB)
- âœ… `Wan2_IceCannon2.1_InfiniteTalk.safetensors` (18.46 GB)

### Wav2Vec æ¨¡å‹çŠ¶æ€

- âš ï¸ **æœªä¸‹è½½**ï¼ˆå¯é€‰ï¼‰
- ğŸ“ å‚è€ƒ `Wav2Vecæ¨¡å‹ä¸‹è½½è¯´æ˜.md` äº†è§£å¦‚ä½•ä¸‹è½½
- âœ… æ— éŸ³é¢‘æ¨¡å¼å¯ä»¥æ­£å¸¸å·¥ä½œï¼ˆä½¿ç”¨é™éŸ³åµŒå…¥ï¼‰

---

## ğŸ”§ å·¥ä½œåŸç†

### folder_paths ç³»ç»Ÿ

ComfyUI ä½¿ç”¨ `folder_paths` æ¨¡å—æ¥ç®¡ç†æ‰€æœ‰æ¨¡å‹è·¯å¾„ï¼š

```python
# æ³¨å†Œæ¨¡å‹ç±»å‹
folder_paths.folder_names_and_paths["wav2vec2"] = (
    [path1, path2, ...],  # æœç´¢è·¯å¾„åˆ—è¡¨
    {'.safetensors', '.bin', ...}  # æ”¯æŒçš„æ‰©å±•å
)

# æŸ¥æ‰¾æ¨¡å‹
models = folder_paths.get_filename_list("wav2vec2")
# è¿”å›: ['model1.safetensors', 'model2.bin', ...]

# è·å–å®Œæ•´è·¯å¾„
full_path = folder_paths.get_full_path("wav2vec2", "model1.safetensors")
# è¿”å›: 'E:/path/to/models/wav2vec2/model1.safetensors'
```

### ä¼˜åŠ¿

1. **ç»Ÿä¸€ç®¡ç†**: æ‰€æœ‰æ¨¡å‹ä½¿ç”¨ç›¸åŒçš„è·¯å¾„ç³»ç»Ÿ
2. **å¤šè·¯å¾„æ”¯æŒ**: å¯ä»¥é…ç½®å¤šä¸ªæœç´¢è·¯å¾„
3. **è‡ªåŠ¨æœç´¢**: è‡ªåŠ¨æœç´¢æ‰€æœ‰é…ç½®çš„ç›®å½•
4. **å­ç›®å½•æ”¯æŒ**: æ”¯æŒå­ç›®å½•ä¸­çš„æ¨¡å‹
5. **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„æ¨¡å‹ç±»å‹

---

## âœ… éªŒè¯ä¿®å¤

### æµ‹è¯• 1ï¼šæ£€æŸ¥ folder_paths é…ç½®

```python
from genesis.core import folder_paths

# æ£€æŸ¥ wav2vec2 æ˜¯å¦å·²æ³¨å†Œ
print(folder_paths.get_folder_paths("wav2vec2"))
# åº”è¯¥è¾“å‡º: ['E:/liliyuanshangmie/genesis_hand/genesis/models/wav2vec2']

# æ£€æŸ¥å¯ç”¨æ¨¡å‹
print(folder_paths.get_filename_list("wav2vec2"))
# å¦‚æœæœ‰æ¨¡å‹ï¼Œè¾“å‡ºæ–‡ä»¶ååˆ—è¡¨ï¼›å¦åˆ™è¾“å‡º []
```

### æµ‹è¯• 2ï¼šè¿è¡Œä¾èµ–æ£€æŸ¥

```bash
python313\python.exe check_infinitetalk_deps.py
```

**é¢„æœŸè¾“å‡º**:
```
âœ… æ‰€æœ‰ Python ä¾èµ–éƒ½å·²å®‰è£…ï¼
âš ï¸  Wav2Vec æ¨¡å‹ç›®å½•å­˜åœ¨ä½†ä¸ºç©ºï¼ˆæ­£å¸¸ï¼Œå¯é€‰ï¼‰
```

### æµ‹è¯• 3ï¼šæµ‹è¯•æ— éŸ³é¢‘æ¨¡å¼

```bash
python313\python.exe genesis\apps\wanvideo_gradio_app.py
```

1. ä¸Šä¼ å›¾ç‰‡
2. é€‰æ‹© InfiniteTalk æ¨¡å¼
3. **ä¸ä¸Šä¼ éŸ³é¢‘**
4. ç”Ÿæˆè§†é¢‘

**é¢„æœŸè¡Œä¸º**:
```
[WARNING] No Wav2Vec model found via folder_paths, audio will be skipped
[INFO] Continuing without audio...
[DEBUG] No audio provided, creating silent embeds for InfiniteTalk...
[INFO] Silent embeds created for XXX frames
```

---

## ğŸ“ ä»£ç å¯¹æ¯”

### ä¿®æ”¹å‰ï¼ˆç¡¬ç¼–ç è·¯å¾„ï¼‰

```python
# âŒ ç¡¬ç¼–ç è·¯å¾„ï¼Œä¸çµæ´»
import glob
wav2vec_models = glob.glob("models/wav2vec2/*.safetensors") + glob.glob("models/wav2vec2/*.bin")

if not wav2vec_models:
    print("[WARNING] No Wav2Vec model found in models/wav2vec2/")
    
model_file = os.path.basename(wav2vec_models[0])
```

**é—®é¢˜**:
- åªæ£€æŸ¥ä¸€ä¸ªå›ºå®šè·¯å¾„
- ä¸æ”¯æŒå­ç›®å½•
- ä¸æ”¯æŒå¤šè·¯å¾„é…ç½®
- ä¸ ComfyUI ç³»ç»Ÿä¸ä¸€è‡´

### ä¿®æ”¹åï¼ˆä½¿ç”¨ folder_pathsï¼‰

```python
# âœ… ä½¿ç”¨ folder_paths ç³»ç»Ÿï¼Œçµæ´»ä¸”ä¸€è‡´
from genesis.core import folder_paths
wav2vec_models = folder_paths.get_filename_list("wav2vec2")

if not wav2vec_models:
    print("[WARNING] No Wav2Vec model found via folder_paths")
    
model_file = wav2vec_models[0]  # ç›´æ¥ä½¿ç”¨æ–‡ä»¶å
```

**ä¼˜åŠ¿**:
- ä½¿ç”¨æ ‡å‡† folder_paths ç³»ç»Ÿ
- è‡ªåŠ¨æœç´¢æ‰€æœ‰é…ç½®è·¯å¾„
- æ”¯æŒå­ç›®å½•å’Œå¤šè·¯å¾„
- ä¸å…¶ä»–æ¨¡å‹åŠ è½½ä¸€è‡´

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### ç«‹å³å¯ç”¨ï¼ˆæ— éŸ³é¢‘æ¨¡å¼ï¼‰âœ…

```bash
python313\python.exe genesis\apps\wanvideo_gradio_app.py
```

**åŠŸèƒ½**:
- âœ… å›¾ç‰‡ç”Ÿæˆè§†é¢‘
- âœ… InfiniteTalk æ¨¡å¼
- âœ… è‡ªåŠ¨ä½¿ç”¨é™éŸ³åµŒå…¥
- âœ… æ‰€æœ‰ 3 ä¸ª InfiniteTalk æ¨¡å‹å¯é€‰

### å¯é€‰ï¼šæ·»åŠ éŸ³é¢‘åŠŸèƒ½

å¦‚æœéœ€è¦éŸ³é¢‘é©±åŠ¨çš„å”‡å½¢åŒæ­¥ï¼š

1. å‚è€ƒ `Wav2Vecæ¨¡å‹ä¸‹è½½è¯´æ˜.md`
2. ä¸‹è½½ Wav2Vec æ¨¡å‹åˆ° `models/wav2vec2/`
3. é‡æ–°æµ‹è¯•

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æ¨¡å‹é“¾æ¥å®ŒæˆæŠ¥å‘Š.md** - æ¨¡å‹é“¾æ¥è¯¦æƒ…
- **Wav2Vecæ¨¡å‹ä¸‹è½½è¯´æ˜.md** - Wav2Vec ä¸‹è½½æŒ‡å—
- **INFINITETALK_DEPS_COMPLETE.md** - å®Œæ•´ä¾èµ–æŠ¥å‘Š
- **check_infinitetalk_deps.py** - ä¾èµ–æ£€æŸ¥è„šæœ¬

---

## âœ… æ€»ç»“

**æ‰€æœ‰è·¯å¾„é—®é¢˜å·²ä¿®å¤ï¼**

- âœ… `wav2vec2` å·²æ·»åŠ åˆ° `folder_paths`
- âœ… Wav2Vec åŠ è½½é€»è¾‘å·²ä¿®æ”¹ä¸ºä½¿ç”¨ `folder_paths`
- âœ… ä¸ ComfyUI æ ‡å‡†ç³»ç»Ÿä¸€è‡´
- âœ… æ— éŸ³é¢‘æ¨¡å¼å¯ä»¥æ­£å¸¸å·¥ä½œ
- âœ… æ‰€æœ‰ InfiniteTalk æ¨¡å‹å·²é“¾æ¥

**ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨ InfiniteTalk åŠŸèƒ½äº†ï¼** ğŸ‰
