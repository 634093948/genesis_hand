# âœ… å›¾ç‰‡å¤„ç†å‚æ•°æ­£å¼é›†æˆå®Œæˆ

## ğŸ‰ é›†æˆæˆåŠŸï¼

å·²æˆåŠŸå°† ComfyUI `ImageResizeKJv2` èŠ‚ç‚¹çš„å›¾ç‰‡å¤„ç†å‚æ•°é›†æˆåˆ°æ‰€æœ‰å›¾ç”Ÿè§†é¢‘æ¨¡å¼ä¸­ã€‚

---

## ğŸ“¦ å¤‡ä»½ä¿¡æ¯

### æ–°å»ºå¤‡ä»½
```
wanvideo_gradio_app.py.working_backup_20251114_111351
```
- **å¤§å°**: 117,551 å­—èŠ‚
- **æ—¶é—´**: 2025/11/14 11:13:51
- **çŠ¶æ€**: å¯å·¥ä½œçš„åŸå§‹ç‰ˆæœ¬ âœ…

### ç°æœ‰å¤‡ä»½
```
wanvideo_gradio_app.py.backup
```
- **å¤§å°**: 117,551 å­—èŠ‚
- **çŠ¶æ€**: åŸå§‹å¤‡ä»½ âœ…

**ä¸¤ä¸ªå¤‡ä»½éƒ½å·²ç¡®ä¿å®‰å…¨ï¼** ğŸ”’

---

## ğŸ¨ æ–°å¢åŠŸèƒ½

### 1. å›¾ç‰‡å¤„ç†å‚æ•°ï¼ˆ3ä¸ªï¼‰

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| **keep_proportion** | Radio | `crop` | å›¾ç‰‡é€‚é…æ–¹å¼ |
| **crop_position** | Dropdown | `center` | è£å‰ªä½ç½® |
| **upscale_method** | Dropdown | `lanczos` | ç¼©æ”¾ç®—æ³• |

### 2. keep_proportion (å›¾ç‰‡é€‚é…æ–¹å¼)

**é€‰é¡¹**:
- âœ… `crop` - è£å‰ªå¤šä½™éƒ¨åˆ†ï¼ˆæ— é»‘è¾¹ï¼‰
- âœ… `pad` - æ·»åŠ é»‘è¾¹ï¼ˆå®Œæ•´æ˜¾ç¤ºï¼‰
- âœ… `stretch` - æ‹‰ä¼¸ï¼ˆå¯èƒ½å˜å½¢ï¼‰

**é»˜è®¤**: `crop` ï¼ˆä¸ ComfyUI ä¸€è‡´ï¼‰

### 3. crop_position (è£å‰ªä½ç½®)

**é€‰é¡¹**:
- âœ… `center` - å±…ä¸­è£å‰ª
- âœ… `top` - é¡¶éƒ¨å¯¹é½
- âœ… `bottom` - åº•éƒ¨å¯¹é½
- âœ… `left` - å·¦å¯¹é½
- âœ… `right` - å³å¯¹é½

**é»˜è®¤**: `center` ï¼ˆä¸ ComfyUI ä¸€è‡´ï¼‰
**ç”Ÿæ•ˆæ¡ä»¶**: ä»…åœ¨ `crop` æ¨¡å¼ä¸‹ç”Ÿæ•ˆ

### 4. upscale_method (ç¼©æ”¾ç®—æ³•)

**é€‰é¡¹**:
- âœ… `lanczos` - æœ€é«˜è´¨é‡ï¼ˆæ¨èï¼‰
- âœ… `bicubic` - é«˜è´¨é‡
- âœ… `bilinear` - ä¸­ç­‰è´¨é‡
- âœ… `nearest` - æœ€å¿«é€Ÿåº¦

**é»˜è®¤**: `lanczos` ï¼ˆä¸ ComfyUI ä¸€è‡´ï¼‰

---

## ğŸ“ ä¿®æ”¹è¯¦æƒ…

### ä¿®æ”¹ 1: UI ç»„ä»¶æ·»åŠ 

**ä½ç½®**: ç¬¬ 1596-1620 è¡Œ

**æ–°å¢ç»„ä»¶**:
```python
# Image processing settings (å…±é€šå‚æ•°)
with gr.Group():
    gr.Markdown("### ğŸ“ å›¾ç‰‡å¤„ç†")
    
    keep_proportion = gr.Radio(
        choices=["crop", "pad", "stretch"],
        value="crop",
        label="å›¾ç‰‡é€‚é…æ–¹å¼",
        info="crop: è£å‰ªå¤šä½™éƒ¨åˆ†(æ— é»‘è¾¹) | pad: æ·»åŠ é»‘è¾¹(å®Œæ•´æ˜¾ç¤º) | stretch: æ‹‰ä¼¸(å¯èƒ½å˜å½¢)"
    )
    
    with gr.Row():
        crop_position = gr.Dropdown(
            choices=["center", "top", "bottom", "left", "right"],
            value="center",
            label="è£å‰ªä½ç½®",
            info="ä»… crop æ¨¡å¼ç”Ÿæ•ˆ"
        )
        
        upscale_method = gr.Dropdown(
            choices=["lanczos", "bicubic", "bilinear", "nearest"],
            value="lanczos",
            label="ç¼©æ”¾ç®—æ³•",
            info="lanczos: æœ€é«˜è´¨é‡"
        )
```

### ä¿®æ”¹ 2: æŒ‰é’® inputs åˆ—è¡¨

**ä½ç½®**: ç¬¬ 1888 è¡Œ

**æ–°å¢å‚æ•°**:
```python
keep_proportion, crop_position, upscale_method,  # å›¾ç‰‡å¤„ç†å‚æ•°
```

**å‚æ•°æ€»æ•°**: 29 â†’ **32** âœ…

### ä¿®æ”¹ 3: å‚æ•°è§£åŒ…

**ä½ç½®**: ç¬¬ 1793 è¡Œ

**æ–°å¢è§£åŒ…**:
```python
keep_proportion, crop_position, upscale_method,  # å›¾ç‰‡å¤„ç†å‚æ•°
```

**é”™è¯¯æç¤º**: æ›´æ–°ä¸º `Expected 32 args`

### ä¿®æ”¹ 4: å‡½æ•°è°ƒç”¨

**ä½ç½®**: ç¬¬ 1834-1836 è¡Œ

**æ–°å¢ä¼ é€’**:
```python
keep_proportion=keep_proportion,
crop_position=crop_position,
upscale_method=upscale_method,
```

### ä¿®æ”¹ 5: å‡½æ•°ç­¾å

**ä½ç½®**: ç¬¬ 221-224 è¡Œ

**æ–°å¢å‚æ•°**:
```python
# Image processing parameters
keep_proportion: str = "crop",
crop_position: str = "center",
upscale_method: str = "lanczos",
```

---

## ğŸ¯ UI ç»“æ„

### å…±é€šå‚æ•°åŒºåŸŸï¼ˆæ‰€æœ‰æ¨¡å¼å¯è§ï¼‰

```
ğŸ–¼ï¸ Image to Video
â”‚
â”œâ”€â”€ è¾“å…¥å›¾ç‰‡
â”œâ”€â”€ æ¨¡å¼é€‰æ‹© [InfiniteTalk | WanAnimate | Standard I2V]
â”œâ”€â”€ Positive Prompt
â”œâ”€â”€ Negative Prompt
â”‚
â”œâ”€â”€ ğŸ“ å›¾ç‰‡å¤„ç† â† æ–°å¢ï¼
â”‚   â”œâ”€â”€ å›¾ç‰‡é€‚é…æ–¹å¼ (crop/pad/stretch)
â”‚   â”œâ”€â”€ è£å‰ªä½ç½® (center/top/bottom/left/right)
â”‚   â””â”€â”€ ç¼©æ”¾ç®—æ³• (lanczos/bicubic/bilinear/nearest)
â”‚
â”œâ”€â”€ è§†é¢‘å‚æ•°
â”‚   â”œâ”€â”€ Width / Height
â”‚   â””â”€â”€ Frames / FPS
â”‚
â”œâ”€â”€ ç”Ÿæˆå‚æ•°
â”‚   â”œâ”€â”€ Steps / CFG / Shift
â”‚   â”œâ”€â”€ Seed / Scheduler
â”‚   â””â”€â”€ Denoise
â”‚
â”œâ”€â”€ æ¨¡å‹é€‰æ‹©
â”‚   â”œâ”€â”€ Diffusion Model
â”‚   â”œâ”€â”€ VAE Model
â”‚   â””â”€â”€ T5 Encoder
â”‚
â””â”€â”€ é«˜çº§è®¾ç½®
    â”œâ”€â”€ åŸºç¡€ç²¾åº¦
    â”œâ”€â”€ é‡åŒ–
    â””â”€â”€ æ³¨æ„åŠ›æ¨¡å¼
```

### æ¨¡å¼ç‰¹å®šå‚æ•°ï¼ˆåŠ¨æ€æ˜¾ç¤ºï¼‰

```
ğŸ™ï¸ InfiniteTalk è®¾ç½® (ä»… InfiniteTalk æ˜¾ç¤º)
â”œâ”€â”€ éŸ³é¢‘æ–‡ä»¶
â”œâ”€â”€ Frame Window Size
â”œâ”€â”€ Motion Frame
â””â”€â”€ Wav2Vec è®¾ç½®

ğŸ­ WanAnimate è®¾ç½® (ä»… WanAnimate æ˜¾ç¤º)
â”œâ”€â”€ å§¿æ€å›¾ç‰‡
â”œâ”€â”€ é¢éƒ¨å›¾ç‰‡
â””â”€â”€ Pose/Face Strength
```

---

## ğŸ“Š å‚æ•°å¯¹ç…§è¡¨ï¼ˆ32ä¸ªï¼‰

| # | æŒ‰é’® Input | å‡½æ•°å‚æ•° | ç±»å‹ |
|---|-----------|---------|------|
| 1 | input_image | input_image | PIL.Image |
| 2 | i2v_mode | mode | str |
| 3 | i2v_positive_prompt | positive_prompt | str |
| 4 | i2v_negative_prompt | negative_prompt | str |
| 5 | i2v_model_name | model_name | str |
| 6 | i2v_vae_name | vae_name | str |
| 7 | i2v_t5_model | t5_model | str |
| 8 | i2v_width | width | int |
| 9 | i2v_height | height | int |
| 10 | i2v_num_frames | num_frames | int |
| 11 | i2v_steps | steps | int |
| 12 | i2v_cfg | cfg | float |
| 13 | i2v_shift | shift | float |
| 14 | i2v_seed | seed | int |
| 15 | i2v_scheduler | scheduler | str |
| 16 | i2v_denoise | denoise | float |
| 17 | i2v_base_precision | base_precision | str |
| 18 | i2v_quantization | quantization | str |
| 19 | i2v_attention_mode | attention_mode | str |
| 20 | audio_file | audio_file | str/None |
| 21 | frame_window_size | frame_window_size | int |
| 22 | motion_frame | motion_frame | int |
| 23 | wav2vec_precision | wav2vec_precision | str |
| 24 | wav2vec_device | wav2vec_device | str |
| 25 | **keep_proportion** | **keep_proportion** | **str** â† æ–°å¢ |
| 26 | **crop_position** | **crop_position** | **str** â† æ–°å¢ |
| 27 | **upscale_method** | **upscale_method** | **str** â† æ–°å¢ |
| 28 | pose_images | pose_images | Any |
| 29 | face_images | face_images | Any |
| 30 | pose_strength | pose_strength | float |
| 31 | face_strength | face_strength | float |
| 32 | colormatch | colormatch | str |
| 33 | i2v_fps | fps | int |

**æ€»è®¡**: 32 ä¸ªå‚æ•° âœ…

---

## ğŸ” ä¸ ComfyUI å¯¹æ¯”

### ComfyUI ImageResizeKJv2 èŠ‚ç‚¹

```python
å‚æ•°é…ç½®:
- width: 832
- height: 480
- upscale_method: 'lanczos'     âœ… å·²é›†æˆ
- keep_proportion: 'crop'       âœ… å·²é›†æˆ
- crop_position: 'center'       âœ… å·²é›†æˆ
- pad_color: '0, 0, 0'          âš ï¸ æœªé›†æˆï¼ˆå¯é€‰ï¼‰
- divisible_by: 2               âš ï¸ æœªé›†æˆï¼ˆä¸éœ€è¦ï¼‰
- device: 'cpu'                 âš ï¸ æœªé›†æˆï¼ˆä¸éœ€è¦ï¼‰
```

### æˆ‘ä»¬çš„å®ç°

```python
é»˜è®¤é…ç½®:
- keep_proportion: 'crop'       âœ… å®Œå…¨ä¸€è‡´
- upscale_method: 'lanczos'     âœ… å®Œå…¨ä¸€è‡´
- crop_position: 'center'       âœ… å®Œå…¨ä¸€è‡´
```

**æ ¸å¿ƒå‚æ•°å®Œå…¨åŒ¹é… ComfyUIï¼** ğŸ¯

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: Pad æ¨¡å¼ï¼ˆæ·»åŠ é»‘è¾¹ï¼‰

**åœºæ™¯**: ä½ æœ‰ä¸€å¼  1920x1080 çš„å›¾ç‰‡ï¼Œæƒ³è¦å®Œæ•´æ˜¾ç¤º

**æ“ä½œ**:
1. é€‰æ‹©ä»»æ„æ¨¡å¼ï¼ˆInfiniteTalk/WanAnimate/Standard I2Vï¼‰
2. ä¸Šä¼ å›¾ç‰‡
3. è®¾ç½®ç›®æ ‡å°ºå¯¸: 832x480
4. **å›¾ç‰‡é€‚é…æ–¹å¼**: é€‰æ‹© `pad`
5. ç”Ÿæˆè§†é¢‘

**ç»“æœ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ â”‚ â† ä¸Šä¸‹é»‘è¾¹
â”‚  [  å®Œæ•´å›¾ç‰‡  ]    â”‚ â† å›¾ç‰‡å®Œæ•´æ˜¾ç¤º
â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ â”‚ â† ä¸Šä¸‹é»‘è¾¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
832x480ï¼Œæœ‰é»‘è¾¹ï¼Œå®Œæ•´æ˜¾ç¤º âœ…
```

### ç¤ºä¾‹ 2: Crop æ¨¡å¼ï¼ˆæ— é»‘è¾¹ï¼‰

**åœºæ™¯**: ä½ æƒ³è¦æ— é»‘è¾¹çš„é¥±æ»¡ç”»é¢

**æ“ä½œ**:
1. é€‰æ‹©ä»»æ„æ¨¡å¼
2. ä¸Šä¼ å›¾ç‰‡
3. è®¾ç½®ç›®æ ‡å°ºå¯¸: 832x480
4. **å›¾ç‰‡é€‚é…æ–¹å¼**: é€‰æ‹© `crop`ï¼ˆé»˜è®¤ï¼‰
5. **è£å‰ªä½ç½®**: é€‰æ‹© `center`ï¼ˆé»˜è®¤ï¼‰
6. ç”Ÿæˆè§†é¢‘

**ç»“æœ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [  å›¾ç‰‡å†…å®¹  ]    â”‚ â† æ— é»‘è¾¹
â”‚  [  å±…ä¸­è£å‰ª  ]    â”‚ â† ç”»é¢é¥±æ»¡
â”‚  [  éƒ¨åˆ†æ˜¾ç¤º  ]    â”‚ â† å¯èƒ½è£æ‰è¾¹ç¼˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
832x480ï¼Œæ— é»‘è¾¹ï¼Œè£å‰ªæ˜¾ç¤º âœ…
```

### ç¤ºä¾‹ 3: ä¸åŒè£å‰ªä½ç½®

**åœºæ™¯**: äººç‰©åœ¨å›¾ç‰‡é¡¶éƒ¨ï¼Œæƒ³ä¿ç•™å¤´éƒ¨

**æ“ä½œ**:
1. **å›¾ç‰‡é€‚é…æ–¹å¼**: `crop`
2. **è£å‰ªä½ç½®**: é€‰æ‹© `top`
3. ç”Ÿæˆè§†é¢‘

**ç»“æœ**: ä¿ç•™å›¾ç‰‡é¡¶éƒ¨ï¼Œè£æ‰åº•éƒ¨ âœ…

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

- [ ] InfiniteTalk æ¨¡å¼ç”Ÿæˆ
- [ ] WanAnimate æ¨¡å¼ç”Ÿæˆ
- [ ] Standard I2V æ¨¡å¼ç”Ÿæˆ
- [ ] æ‰€æœ‰æ¨¡å¼éƒ½èƒ½æ­£å¸¸ç‚¹å‡»ç”Ÿæˆ

### å›¾ç‰‡å¤„ç†æµ‹è¯•

- [ ] Crop æ¨¡å¼æµ‹è¯•ï¼ˆé»˜è®¤ï¼‰
- [ ] Pad æ¨¡å¼æµ‹è¯•ï¼ˆæ·»åŠ é»‘è¾¹ï¼‰
- [ ] Stretch æ¨¡å¼æµ‹è¯•ï¼ˆæ‹‰ä¼¸ï¼‰
- [ ] ä¸åŒè£å‰ªä½ç½®æµ‹è¯•ï¼ˆcenter/top/bottom/left/rightï¼‰
- [ ] ä¸åŒç¼©æ”¾ç®—æ³•æµ‹è¯•ï¼ˆlanczos/bicubic/bilinear/nearestï¼‰

### å…¼å®¹æ€§æµ‹è¯•

- [ ] åŸæœ‰åŠŸèƒ½ä¸å—å½±å“
- [ ] éŸ³é¢‘å¤„ç†æ­£å¸¸
- [ ] è§†é¢‘ç”Ÿæˆæ­£å¸¸
- [ ] å‚æ•°ä¼ é€’æ­£ç¡®

---

## ğŸ¯ å…³é”®æ”¹è¿›

### 1. æ­£ç¡®çš„å‚æ•°ä½ç½® âœ…

**å›¾ç‰‡å¤„ç†å‚æ•°æ”¾åœ¨å…±é€šåŒºåŸŸ**ï¼Œæ‰€æœ‰æ¨¡å¼éƒ½å¯ä»¥è®¿é—®ï¼Œä¸ä¼šå› ä¸ºç»„éšè—è€Œå¯¼è‡´å˜é‡ä¸å¯è®¿é—®ã€‚

### 2. å®Œæ•´çš„å‚æ•°æµ âœ…

```
UI ç»„ä»¶ â†’ æŒ‰é’® inputs â†’ å‚æ•°è§£åŒ… â†’ å‡½æ•°è°ƒç”¨ â†’ å‡½æ•°ç­¾å
   âœ…         âœ…           âœ…          âœ…         âœ…
```

### 3. å‚æ•°æ•°é‡åŒ¹é… âœ…

- æŒ‰é’® inputs: 32 ä¸ª
- å‚æ•°è§£åŒ…: 32 ä¸ª
- å‡½æ•°ç­¾å: 32 ä¸ª

**å®Œå…¨åŒ¹é…ï¼** âœ…

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. **ComfyUIå›¾ç‰‡å¤„ç†åˆ†æ.md** - ComfyUI èŠ‚ç‚¹åˆ†æ
2. **å›¾ç‰‡å¤„ç†å‚æ•°é›†æˆå®Œæˆ.md** - ç¬¬ä¸€æ¬¡é›†æˆï¼ˆæœ‰é—®é¢˜ï¼‰
3. **InfiniteTalkç‚¹å‡»æ— ååº”ä¿®å¤.md** - é—®é¢˜è¯Šæ–­
4. **æ¢å¤åŸå§‹å·¥ä½œçŠ¶æ€.md** - æ¢å¤å¤‡ä»½
5. **å›¾ç‰‡å¤„ç†å‚æ•°æ­£å¼é›†æˆå®Œæˆ.md** - æœ¬æ–‡æ¡£ï¼ˆæ­£å¼ç‰ˆï¼‰

---

## âœ… å®ŒæˆçŠ¶æ€

### å·²å®Œæˆ

- [x] åˆ›å»ºæ–°å¤‡ä»½
- [x] æ·»åŠ  UI ç»„ä»¶
- [x] æ›´æ–°æŒ‰é’® inputs
- [x] æ›´æ–°å‚æ•°è§£åŒ…
- [x] æ›´æ–°å‡½æ•°è°ƒç”¨
- [x] æ›´æ–°å‡½æ•°ç­¾å
- [x] å‚æ•°æ•°é‡åŒ¹é…ï¼ˆ32ä¸ªï¼‰
- [x] ä¸ ComfyUI é»˜è®¤å€¼ä¸€è‡´

### å¾…æµ‹è¯•

- [ ] æ‰€æœ‰æ¨¡å¼ç”Ÿæˆæµ‹è¯•
- [ ] å›¾ç‰‡å¤„ç†åŠŸèƒ½æµ‹è¯•
- [ ] å…¼å®¹æ€§æµ‹è¯•

---

## ğŸ‰ æ€»ç»“

### æ–°å¢åŠŸèƒ½

âœ… **3 ä¸ªå›¾ç‰‡å¤„ç†å‚æ•°**
- keep_proportion (crop/pad/stretch)
- crop_position (center/top/bottom/left/right)
- upscale_method (lanczos/bicubic/bilinear/nearest)

### ä¸ ComfyUI ä¸€è‡´

âœ… **é»˜è®¤é…ç½®å®Œå…¨åŒ¹é…**
- crop æ¨¡å¼
- lanczos ç®—æ³•
- center è£å‰ª

### ç”¨æˆ·å‹å¥½

âœ… **æ¸…æ™°çš„ UI**
- è¯¦ç»†çš„è¯´æ˜
- ç›´è§‚çš„é€‰é¡¹
- åˆç†çš„é»˜è®¤å€¼
- æ‰€æœ‰æ¨¡å¼éƒ½å¯ç”¨

### å®‰å…¨ä¿éšœ

âœ… **åŒé‡å¤‡ä»½**
- wanvideo_gradio_app.py.backup
- wanvideo_gradio_app.py.working_backup_20251114_111351

---

**å›¾ç‰‡å¤„ç†å‚æ•°å·²æ­£å¼é›†æˆå®Œæˆï¼ç°åœ¨å¯ä»¥æµ‹è¯•äº†ï¼** ğŸŠ
