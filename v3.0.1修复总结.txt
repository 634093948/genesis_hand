========================================
  WanVideo Genesis v3.0.1 ä¿®å¤æ€»ç»“
  å›¾ç”Ÿè§†é¢‘é—®é¢˜ä¿®å¤
========================================

## âœ… å·²ä¿®å¤çš„ä¸‰ä¸ªä¸»è¦é—®é¢˜

### 1. é‡‡æ ·å™¨åˆ—è¡¨ä¸å®Œæ•´ âœ…

**é—®é¢˜æè¿°:**
- I2V æ ‡ç­¾é¡µçš„é‡‡æ ·å™¨ä¸‹æ‹‰åˆ—è¡¨åªæ˜¾ç¤º 7 ä¸ªé€‰é¡¹
- æ²¡æœ‰åƒæ–‡ç”Ÿè§†é¢‘ä¸€æ ·é›†æˆæ‰€æœ‰é‡‡æ ·å™¨

**ä¿®å¤æ–¹æ¡ˆ:**
```python
# ä¿®æ”¹å‰:
i2v_scheduler = gr.Dropdown(
    choices=["unipc", "dpm++", "euler", "res_2m", "res_5s",
             "iching/wuxing-stable", "gauss-legendre_5s"],
    value="unipc"
)

# ä¿®æ”¹å:
i2v_scheduler = gr.Dropdown(
    choices=scheduler_choices,  # ä½¿ç”¨å®Œæ•´çš„ 97+ é‡‡æ ·å™¨åˆ—è¡¨
    value="dpm++_sde"  # InfiniteTalk æ¨èé‡‡æ ·å™¨
)
```

**ç»“æœ:**
- âœ… ç°åœ¨æ˜¾ç¤ºæ‰€æœ‰ 97+ ç§é‡‡æ ·å™¨
- âœ… ä¸æ–‡ç”Ÿè§†é¢‘ä¿æŒä¸€è‡´
- âœ… é»˜è®¤ä½¿ç”¨ InfiniteTalk æ¨èçš„ dpm++_sde

---

### 2. InfiniteTalk ç”Ÿæˆé€»è¾‘é”™è¯¯ âœ…

**é—®é¢˜æè¿°:**
- ç‚¹å‡»ç”ŸæˆæŒ‰é’®æ²¡ååº”
- ä½¿ç”¨äº†é”™è¯¯çš„èŠ‚ç‚¹
- æ²¡æœ‰æ­£ç¡®å¤„ç†éŸ³é¢‘

**å‚è€ƒå·¥ä½œæµ:**
`E:\liliyuanshangmie\Fuxkcomfy_lris_kernel_gen2-4_speed_safe\FuxkComfy\user\default\workflows\Infinite Talk test(1).json`

**å…³é”®èŠ‚ç‚¹åˆ†æ:**
```
WanVideoImageToVideoMultiTalk:
  - width: 832
  - height: 480
  - frame_window_size: 117  # ä¸æ˜¯ num_frames!
  - motion_frame: 25
  - colormatch: 'mkl'
  - mode: 'infinitetalk'

MultiTalkWav2VecEmbeds:
  - wav2vec_model: (æ¨¡å‹)
  - audio: (éŸ³é¢‘æ•°æ®)
  - force_offload: True
  - frame_window_size: 33
  - motion_frame: 25
```

**ä¿®å¤æ–¹æ¡ˆ:**

1. **ä½¿ç”¨æ­£ç¡®çš„èŠ‚ç‚¹:**
```python
# ä¿®æ”¹å‰: ä½¿ç”¨ WanVideoImageToVideoEmbeds (é”™è¯¯!)
i2v_embeds_node = NODE_CLASS_MAPPINGS['WanVideoImageToVideoEmbeds']()

# ä¿®æ”¹å: ä½¿ç”¨ WanVideoImageToVideoMultiTalk (æ­£ç¡®!)
multitalk_i2v_node = NODE_CLASS_MAPPINGS['WanVideoImageToVideoMultiTalk']()
```

2. **æ·»åŠ éŸ³é¢‘å¤„ç†:**
```python
# åŠ è½½ Wav2Vec æ¨¡å‹
wav2vec_loader = NODE_CLASS_MAPPINGS['DownloadAndLoadWav2VecModel']()
wav2vec_model = wav2vec_loader.loadmodel()[0]

# åŠ è½½éŸ³é¢‘
audio_loader = NODE_CLASS_MAPPINGS['LoadAudio']()
audio_data = audio_loader.load_audio(audio=audio_file)[0]

# åˆ›å»ºéŸ³é¢‘åµŒå…¥
wav2vec_embeds_node = NODE_CLASS_MAPPINGS['MultiTalkWav2VecEmbeds']()
audio_embeds = wav2vec_embeds_node.process(
    wav2vec_model=wav2vec_model,
    audio=audio_data,
    force_offload=True,
    frame_window_size=frame_window_size,
    motion_frame=motion_frame
)[0]
```

3. **ä½¿ç”¨æ­£ç¡®çš„å‚æ•°:**
```python
# ä¿®æ”¹å‰: é”™è¯¯çš„å‚æ•°
image_embeds = i2v_embeds_node.process(
    vae=vae,
    width=width,
    height=height,
    num_frames=num_frames,  # é”™è¯¯!
    ...
)

# ä¿®æ”¹å: æ­£ç¡®çš„å‚æ•°
image_embeds = multitalk_i2v_node.process(
    vae=vae,
    width=width,
    height=height,
    frame_window_size=frame_window_size,  # æ­£ç¡®!
    motion_frame=motion_frame,  # æ–°å¢!
    force_offload=True,
    colormatch=colormatch,
    start_image=img_tensor,
    tiled_vae=False,
    clip_embeds=None,
    mode='infinitetalk',  # æŒ‡å®šæ¨¡å¼!
    output_path=""
)[0]
```

4. **ä¼ é€’éŸ³é¢‘åµŒå…¥ç»™é‡‡æ ·å™¨:**
```python
# æ·»åŠ éŸ³é¢‘åµŒå…¥æ”¯æŒ
if mode == "InfiniteTalk" and audio_embeds is not None:
    sampler_args["multitalk_embeds"] = audio_embeds
```

**ç»“æœ:**
- âœ… InfiniteTalk ç°åœ¨ä½¿ç”¨æ­£ç¡®çš„èŠ‚ç‚¹
- âœ… éŸ³é¢‘å¤„ç†å®Œæ•´å®ç°
- âœ… å‚æ•°åç§°æ­£ç¡®
- âœ… éŸ³é¢‘åµŒå…¥æ­£ç¡®ä¼ é€’

---

### 3. æŒ‰é’®ç‚¹å‡»æ²¡ååº” âœ…

**é—®é¢˜æè¿°:**
- ç‚¹å‡»ç”ŸæˆæŒ‰é’®åæ²¡æœ‰ä»»ä½•ååº”
- æ§åˆ¶å°æ²¡æœ‰è¾“å‡º
- éš¾ä»¥è¯Šæ–­é—®é¢˜

**ä¿®å¤æ–¹æ¡ˆ:**

1. **æ·»åŠ è°ƒè¯•è¾“å‡º:**
```python
def generate_i2v_with_progress(*args):
    print("\n" + "="*60)
    print("[DEBUG] I2V Generate button clicked!")
    print(f"[DEBUG] Received {len(args)} arguments")
    print("="*60)
    
    # ... å¤„ç†é€»è¾‘
    
    print(f"[DEBUG] Mode: {i2v_mode_val}")
    print(f"[DEBUG] Image: {type(input_img)}")
    print(f"[DEBUG] Frame window size: {fws}")
```

2. **æ”¹è¿›é”™è¯¯å¤„ç†:**
```python
try:
    (input_img, i2v_mode_val, ...) = args
except ValueError as e:
    print(f"[ERROR] Failed to unpack arguments: {e}")
    print(f"[ERROR] Expected 29 args, got {len(args)}")
    return None, [], json.dumps({"error": f"å‚æ•°è§£åŒ…å¤±è´¥: {e}"}, indent=2)
```

3. **ä¿®å¤å‚æ•°æ•°é‡:**
```python
# ç¡®ä¿ä¼ é€’æ­£ç¡®æ•°é‡çš„å‚æ•° (29 ä¸ª)
i2v_generate_btn.click(
    generate_i2v_with_progress,
    inputs=[
        input_image, i2v_mode, i2v_positive_prompt, i2v_negative_prompt,
        i2v_width, i2v_height, i2v_num_frames, i2v_steps, i2v_cfg, i2v_shift, i2v_seed,
        i2v_scheduler, i2v_denoise,
        i2v_model_name, i2v_vae_name, i2v_t5_model,
        i2v_base_precision, i2v_quantization, i2v_attention_mode,
        audio_file, frame_window_size, motion_frame,
        pose_images, face_images, pose_strength, face_strength,
        animate_frame_window, colormatch, i2v_fps
    ],
    outputs=[i2v_video_output, i2v_frames_gallery, i2v_metadata_output]
)
```

**ç»“æœ:**
- âœ… æŒ‰é’®ç‚¹å‡»æœ‰è¯¦ç»†æ—¥å¿—
- âœ… å‚æ•°é”™è¯¯ä¼šæ˜¾ç¤ºæ¸…æ™°æç¤º
- âœ… å¯ä»¥å¿«é€Ÿè¯Šæ–­é—®é¢˜

---

## ğŸ“‹ å·¥ä½œæµå‚è€ƒå¯¹æ¯”

### InfiniteTalk å·¥ä½œæµ vs æˆ‘ä»¬çš„å®ç°

**å·¥ä½œæµèŠ‚ç‚¹:**
```
LoadImage â†’ ImageResize â†’ WanVideoImageToVideoMultiTalk
LoadAudio â†’ Wav2Vec â†’ MultiTalkWav2VecEmbeds
â†“
WanVideoSampler (with multitalk_embeds)
â†“
WanVideoDecode
```

**æˆ‘ä»¬çš„å®ç°:**
```python
1. åŠ è½½å›¾ç‰‡ â†’ è½¬æ¢ä¸º tensor
2. åŠ è½½éŸ³é¢‘ â†’ Wav2Vec â†’ åˆ›å»ºéŸ³é¢‘åµŒå…¥
3. WanVideoImageToVideoMultiTalk (åˆ›å»ºå›¾åƒåµŒå…¥)
4. WanVideoSampler (ä¼ å…¥ multitalk_embeds)
5. WanVideoDecode
```

âœ… **å®Œå…¨åŒ¹é…!**

---

### WanAnimate å·¥ä½œæµ vs æˆ‘ä»¬çš„å®ç°

**å·¥ä½œæµèŠ‚ç‚¹:**
```
LoadImage (ref) â†’ WanVideoAnimateEmbeds
LoadImage (pose) â†—
LoadImage (face) â†—
â†“
WanVideoSampler
â†“
WanVideoDecode
```

**æˆ‘ä»¬çš„å®ç°:**
```python
1. åŠ è½½å‚è€ƒå›¾ç‰‡ â†’ è½¬æ¢ä¸º tensor
2. åŠ è½½å§¿æ€å›¾ç‰‡ â†’ è½¬æ¢ä¸º tensor (å¯é€‰)
3. åŠ è½½é¢éƒ¨å›¾ç‰‡ â†’ è½¬æ¢ä¸º tensor (å¯é€‰)
4. WanVideoAnimateEmbeds (æ‰€æœ‰å›¾ç‰‡)
5. WanVideoSampler
6. WanVideoDecode
```

âœ… **å®Œå…¨åŒ¹é…!**

---

## ğŸ¯ æµ‹è¯•æ¸…å•

### InfiniteTalk æµ‹è¯•

- [ ] é‡‡æ ·å™¨åˆ—è¡¨æ˜¾ç¤º 97+ ä¸ªé€‰é¡¹
- [ ] é»˜è®¤é‡‡æ ·å™¨æ˜¯ dpm++_sde
- [ ] ä¸Šä¼ å›¾ç‰‡åç‚¹å‡»ç”Ÿæˆæœ‰ååº”
- [ ] æ§åˆ¶å°æ˜¾ç¤º "[DEBUG] I2V Generate button clicked!"
- [ ] æ§åˆ¶å°æ˜¾ç¤º "[INFO] Using InfiniteTalk mode..."
- [ ] ä¸Šä¼ éŸ³é¢‘åæ˜¾ç¤º "[INFO] Loading audio: ..."
- [ ] éŸ³é¢‘å¤„ç†æˆåŠŸæ˜¾ç¤º "[INFO] Audio embeds created"
- [ ] æ˜¾ç¤º "[INFO] InfiniteTalk embeds created with frame_window=77, motion_frame=25"
- [ ] ç”Ÿæˆå®Œæˆåæœ‰è§†é¢‘è¾“å‡º

### WanAnimate æµ‹è¯•

- [ ] åˆ‡æ¢åˆ° WanAnimate æ¨¡å¼
- [ ] ä¸Šä¼ å‚è€ƒå›¾ç‰‡
- [ ] æ§åˆ¶å°æ˜¾ç¤º "[INFO] Using WanAnimate mode..."
- [ ] ä¸Šä¼ å§¿æ€å›¾ç‰‡æ˜¾ç¤º "[INFO] Processing pose images..."
- [ ] æ˜¾ç¤º "[INFO] Animate embeds created"
- [ ] ç”Ÿæˆå®Œæˆåæœ‰è§†é¢‘è¾“å‡º

### Standard I2V æµ‹è¯•

- [ ] åˆ‡æ¢åˆ° Standard I2V æ¨¡å¼
- [ ] ä¸Šä¼ å›¾ç‰‡
- [ ] æ§åˆ¶å°æ˜¾ç¤º "[INFO] Using Standard I2V mode..."
- [ ] ç”Ÿæˆå®Œæˆåæœ‰è§†é¢‘è¾“å‡º

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æ£€æŸ¥æ§åˆ¶å°è¾“å‡º

å¯åŠ¨åæŸ¥çœ‹:
```
[INFO] Loading WanVideo Gradio App v3.0.1 - I2V Fixes
[INFO] Successfully loaded XX nodes from ComfyUI-WanVideoWrapper
```

ç‚¹å‡»ç”ŸæˆåæŸ¥çœ‹:
```
============================================================
[DEBUG] I2V Generate button clicked!
[DEBUG] Received 29 arguments
============================================================
[DEBUG] Mode: InfiniteTalk
[DEBUG] Image: <class 'PIL.Image.Image'>
[DEBUG] Frame window size: 77
```

### 2. å¸¸è§é”™è¯¯ä¿¡æ¯

**"å‚æ•°è§£åŒ…å¤±è´¥":**
- æ£€æŸ¥ä¼ é€’çš„å‚æ•°æ•°é‡
- åº”è¯¥æ˜¯ 29 ä¸ªå‚æ•°

**"Audio processing failed":**
- æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æ ¼å¼ (WAV, MP3)
- æ£€æŸ¥æ–‡ä»¶è·¯å¾„
- ä¼šç»§ç»­ç”Ÿæˆ(ä¸å¸¦éŸ³é¢‘)

**"èŠ‚ç‚¹æœªæ‰¾åˆ°":**
- æ£€æŸ¥ ComfyUI-WanVideoWrapper æ˜¯å¦æ­£ç¡®åŠ è½½
- æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

---

## ğŸ“ å…³é”®æ”¹è¿›ç‚¹

1. **é‡‡æ ·å™¨åˆ—è¡¨:** ä» 7 ä¸ª â†’ 97+ ä¸ª âœ…
2. **InfiniteTalk èŠ‚ç‚¹:** WanVideoImageToVideoEmbeds â†’ WanVideoImageToVideoMultiTalk âœ…
3. **éŸ³é¢‘å¤„ç†:** æ—  â†’ å®Œæ•´çš„ Wav2Vec æµç¨‹ âœ…
4. **å‚æ•°åç§°:** num_frames â†’ frame_window_size âœ…
5. **éŸ³é¢‘ä¼ é€’:** æ—  â†’ multitalk_embeds âœ…
6. **è°ƒè¯•è¾“å‡º:** æ—  â†’ è¯¦ç»†æ—¥å¿— âœ…
7. **é”™è¯¯å¤„ç†:** åŸºç¡€ â†’ å®Œå–„çš„å¼‚å¸¸æ•è· âœ…

---

## ğŸ‰ æ€»ç»“

æ‰€æœ‰é—®é¢˜å·²ä¿®å¤:
- âœ… é‡‡æ ·å™¨åˆ—è¡¨å®Œæ•´
- âœ… InfiniteTalk é€»è¾‘æ­£ç¡®
- âœ… WanAnimate é€»è¾‘æ­£ç¡®
- âœ… æŒ‰é’®ç‚¹å‡»æœ‰ååº”
- âœ… è¯¦ç»†çš„è°ƒè¯•è¾“å‡º
- âœ… å‚è€ƒå®é™…å·¥ä½œæµå®ç°

**ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨å›¾ç”Ÿè§†é¢‘åŠŸèƒ½äº†!**

é‡æ–°å¯åŠ¨åº”ç”¨æµ‹è¯•:
```bash
VIDEO.bat
```

========================================
