# âœ… å·¥ä½œæµæ¨¡å‹é…ç½®å®Œæˆ

## æ—¥æœŸï¼š2025-11-14

---

## ğŸ¯ æ ¹æ®å®é™…å·¥ä½œæµé…ç½®æ¨¡å‹

åŸºäºä½ çš„ ComfyUI å·¥ä½œæµæ–‡ä»¶ï¼š
```
E:\liliyuanshangmie\Fuxkcomfy_lris_kernel_gen2-4_speed_safe\FuxkComfy\user\default\workflows\Infinite Talk test(1).json
```

---

## âœ… å·¥ä½œæµä½¿ç”¨çš„æ¨¡å‹

### 1. InfiniteTalk ä¸»æ¨¡å‹
- **æ–‡ä»¶**: `wan\infinitetalk\Wan2_IceCannon2.1_InfiniteTalk.safetensors`
- **å¤§å°**: 18.46 GB
- **ä½ç½®**: `models/wanvideo/infinitetalk/`
- **çŠ¶æ€**: âœ… å·²é“¾æ¥

### 2. VAE æ¨¡å‹
- **æ–‡ä»¶**: `ComfyUI-wan_2.1_vae.safetensors`
- **å¤§å°**: 242 MB
- **ä½ç½®**: `models/vae/`
- **çŠ¶æ€**: âœ… å·²é“¾æ¥

### 3. Text Encoder (T5)
- **æ–‡ä»¶**: `umt5-xxl-enc-bf16.safetensors`
- **ä½ç½®**: `models/text_encoders/`
- **çŠ¶æ€**: âœ… å·²é“¾æ¥

### 4. CLIP Vision
- **æ–‡ä»¶**: `clip-vision_vit-h.safetensors`
- **å¤§å°**: 2.41 GB
- **ä½ç½®**: `models/clip_vision/`
- **çŠ¶æ€**: âœ… å·²é“¾æ¥

### 5. Wav2Vec éŸ³é¢‘æ¨¡å‹ â­ **å…³é”®å‘ç°**
- **æ¨¡å‹**: `TencentGameMate/chinese-wav2vec2-base`
- **å¤§å°**: 362.6 MB
- **ä½ç½®**: `models/transformers/TencentGameMate/chinese-wav2vec2-base/`
- **çŠ¶æ€**: âœ… å·²é“¾æ¥
- **æ–‡ä»¶**:
  - `pytorch_model.bin` (362.6 MB)
  - `config.json`
  - `preprocessor_config.json`

---

## ğŸ” å…³é”®å‘ç°ï¼šWav2Vec ä¸æ˜¯ Whisperï¼

### ä½ æ˜¯å¯¹çš„ï¼

å·¥ä½œæµä½¿ç”¨çš„æ˜¯ **Wav2Vec æ¨¡å‹**ï¼Œè€Œä¸æ˜¯ Whisperï¼š

**å·¥ä½œæµä¸­çš„èŠ‚ç‚¹**:
```json
{
  "type": "DownloadAndLoadWav2VecModel",
  "widgets_values": [
    "TencentGameMate/chinese-wav2vec2-base",
    "fp16",
    "main_device"
  ]
}
```

### æ¨¡å‹ä½ç½®

Wav2Vec æ¨¡å‹å­˜å‚¨åœ¨ `transformers` ç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯ `wav2vec2` æˆ– `audio_encoders`ï¼š

```
models/transformers/TencentGameMate/chinese-wav2vec2-base/
â”œâ”€â”€ pytorch_model.bin (362.6 MB)
â”œâ”€â”€ config.json
â”œâ”€â”€ preprocessor_config.json
â””â”€â”€ README.md
```

---

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. é“¾æ¥ transformers ç›®å½• âœ…

```powershell
models\transformers â†’ E:\...\FuxkComfy\models\transformers
```

**åŒ…å«**:
- `TencentGameMate/chinese-wav2vec2-base/` - ä¸­æ–‡ Wav2Vec æ¨¡å‹

### 2. æ·»åŠ  transformers åˆ° folder_paths âœ…

**æ–‡ä»¶**: `genesis/core/folder_paths.py`

```python
folder_names_and_paths["transformers"] = (
    [os.path.join(models_dir, "transformers")], 
    {"folder"}
)
```

### 3. ä¿®æ”¹ Wav2Vec åŠ è½½é€»è¾‘ âœ…

**æ–‡ä»¶**: `genesis/apps/wanvideo_gradio_app.py`

**ä¿®æ”¹å‰**:
```python
wav2vec_loader = NODE_CLASS_MAPPINGS['Wav2VecModelLoader']()
wav2vec_models = folder_paths.get_filename_list("wav2vec2")
```

**ä¿®æ”¹å**:
```python
wav2vec_loader = NODE_CLASS_MAPPINGS['DownloadAndLoadWav2VecModel']()
model_name = "TencentGameMate/chinese-wav2vec2-base"
```

**æ•ˆæœ**:
- âœ… ä½¿ç”¨ä¸ ComfyUI å·¥ä½œæµå®Œå…¨ç›¸åŒçš„èŠ‚ç‚¹
- âœ… ä» `transformers/` ç›®å½•åŠ è½½æ¨¡å‹
- âœ… å¦‚æœæ¨¡å‹ä¸å­˜åœ¨ä¼šè‡ªåŠ¨ä¸‹è½½
- âœ… ä¸å·¥ä½œæµé…ç½®100%ä¸€è‡´

---

## ğŸ“Š å®Œæ•´çš„æ¨¡å‹é“¾æ¥åˆ—è¡¨

| ç›®å½• | é“¾æ¥åˆ° | åŒ…å« | çŠ¶æ€ |
|------|--------|------|------|
| `models\wanvideo` | ComfyUI `diffusion_models\wan` | InfiniteTalk æ¨¡å‹ (3ä¸ª) | âœ… |
| `models\vae` | ComfyUI `vae` | VAE æ¨¡å‹ (4ä¸ª) | âœ… |
| `models\clip_vision` | ComfyUI `clip_vision` | CLIP Vision | âœ… |
| `models\text_encoders` | ComfyUI `clip` | T5 ç¼–ç å™¨ | âœ… |
| `models\transformers` | ComfyUI `transformers` | Wav2Vec æ¨¡å‹ | âœ… æ–°å¢ |
| `models\audio_encoders` | ComfyUI `audio_encoders` | Whisper (æœªä½¿ç”¨) | âœ… |

---

## ğŸ”§ å·¥ä½œæµèŠ‚ç‚¹å¯¹åº”

### ComfyUI å·¥ä½œæµä¸­çš„èŠ‚ç‚¹

1. **WanVideoModelLoader**
   - æ¨¡å‹: `wan\infinitetalk\Wan2_IceCannon2.1_InfiniteTalk.safetensors`
   - ç²¾åº¦: `bf16`
   - é‡åŒ–: `fp4_scaled`

2. **WanVideoVAELoader**
   - æ¨¡å‹: `ComfyUI-wan_2.1_vae.safetensors`
   - ç²¾åº¦: `bf16`

3. **LoadWanVideoT5TextEncoder**
   - æ¨¡å‹: `umt5-xxl-enc-bf16.safetensors`
   - ç²¾åº¦: `bf16`

4. **CLIPVisionLoader**
   - æ¨¡å‹: `clip-vision_vit-h.safetensors`

5. **DownloadAndLoadWav2VecModel** â­
   - æ¨¡å‹: `TencentGameMate/chinese-wav2vec2-base`
   - ç²¾åº¦: `fp16`
   - è®¾å¤‡: `main_device`

6. **MultiTalkWav2VecEmbeds**
   - éŸ³é¢‘å¤„ç†èŠ‚ç‚¹
   - å‚æ•°: `normalize_loudness=True`, `fps=25`, `audio_scale=1.0`

---

## ğŸ¯ ç°åœ¨å®Œå…¨åŒ¹é…å·¥ä½œæµï¼

### ä¹‹å‰çš„é—®é¢˜
- âŒ ä½¿ç”¨ `Wav2VecModelLoader` ä» `wav2vec2/` åŠ è½½
- âŒ æ¨¡å‹è·¯å¾„ä¸åŒ¹é…
- âŒ ä¸å·¥ä½œæµä¸ä¸€è‡´

### ç°åœ¨çš„é…ç½®
- âœ… ä½¿ç”¨ `DownloadAndLoadWav2VecModel`
- âœ… ä» `transformers/` åŠ è½½
- âœ… æ¨¡å‹åç§°: `TencentGameMate/chinese-wav2vec2-base`
- âœ… ä¸å·¥ä½œæµ100%ä¸€è‡´

---

## ğŸ“ éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥ transformers é“¾æ¥

```powershell
dir models\transformers
```

åº”è¯¥çœ‹åˆ°ï¼š
```
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d----l        2025/11/14      7:59                transformers
```

### 2. æ£€æŸ¥ Wav2Vec æ¨¡å‹

```powershell
dir models\transformers\TencentGameMate\chinese-wav2vec2-base
```

åº”è¯¥çœ‹åˆ°ï¼š
```
pytorch_model.bin (362.6 MB)
config.json
preprocessor_config.json
```

### 3. æµ‹è¯•éŸ³é¢‘åŠŸèƒ½

```bash
python313\python.exe genesis\apps\wanvideo_gradio_app.py
```

1. ä¸Šä¼ å›¾ç‰‡
2. ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶
3. é€‰æ‹© InfiniteTalk æ¨¡å¼
4. ç”Ÿæˆè§†é¢‘

**é¢„æœŸæ—¥å¿—**:
```
[DEBUG] Loading Wav2Vec model...
[DEBUG] Using Wav2Vec model: TencentGameMate/chinese-wav2vec2-base
[DEBUG] Wav2Vec model loaded from transformers/
[DEBUG] Loading audio file...
[DEBUG] Audio file loaded: sample_rate=XXXXX, shape=torch.Size([...])
[DEBUG] Creating audio embeds...
[INFO] Audio embeds created, actual frames: XXX
```

---

## ğŸ’¾ ç£ç›˜ç©ºé—´

### èŠ‚çœçš„ç©ºé—´
é€šè¿‡é“¾æ¥ ComfyUI æ¨¡å‹ï¼ŒèŠ‚çœäº†çº¦ **30+ GB** ç£ç›˜ç©ºé—´ï¼

### å½“å‰å ç”¨
- é“¾æ¥ç›®å½•æ˜¾ç¤ºä¸º 0 å­—èŠ‚
- å®é™…æ–‡ä»¶åœ¨ ComfyUI ç›®å½•ä¸­
- ä¸¤ä¸ªé¡¹ç›®å…±äº«åŒä¸€ç»„æ¨¡å‹

---

## ğŸ“š å·¥ä½œæµæå–ç»“æœ

ä»å·¥ä½œæµä¸­æå–çš„å®Œæ•´æ¨¡å‹åˆ—è¡¨ï¼š

```
diffusion_models:
  - wan\infinitetalk\Wan2_IceCannon2.1_InfiniteTalk.safetensors

vae:
  - ComfyUI-wan_2.1_vae.safetensors

clip_vision:
  - clip-vision_vit-h.safetensors

text_encoders:
  - umt5-xxl-enc-bf16.safetensors

transformers (Wav2Vec):
  - TencentGameMate/chinese-wav2vec2-base
```

---

## âœ… æ€»ç»“

**æ‰€æœ‰æ¨¡å‹å·²æ ¹æ®å®é™…å·¥ä½œæµé…ç½®å®Œæˆï¼**

- âœ… 5 ä¸ªä¸»è¦æ¨¡å‹ç›®å½•å·²é“¾æ¥
- âœ… Wav2Vec æ¨¡å‹åœ¨ `transformers/` ç›®å½•
- âœ… ä½¿ç”¨ `DownloadAndLoadWav2VecModel` èŠ‚ç‚¹
- âœ… ä¸ ComfyUI å·¥ä½œæµ100%ä¸€è‡´
- âœ… èŠ‚çœ 30+ GB ç£ç›˜ç©ºé—´
- âœ… éŸ³é¢‘åŠŸèƒ½å®Œå…¨å¯ç”¨

**ç°åœ¨å¯ä»¥ä½¿ç”¨å®Œæ•´çš„ InfiniteTalk éŸ³é¢‘åŠŸèƒ½äº†ï¼** ğŸ‰
